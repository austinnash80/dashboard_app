<p id="notice"><%= notice %></p>

<h1 class="text-center">Sequoia Members</h1>
<div class="text-center">
  <%= link_to 'Run New Member Update', run_update_sequoia_members_path(), target: "_blank", class: 'btn btn-primary mt-2' %>
  <%= link_to 'Run Purchase Type Update', run_update_2_sequoia_members_path(run: 'yes'), target: "_blank", class: 'btn btn-primary mt-2' %>
</div>

<p class="fs-4">Upload New List</p>
  <%= form_tag import_sequoia_members_path, multipart: true do %>
  <%= file_field_tag :file, class: 'btn btn-sm btn-light' %>
  <%= submit_tag 'Upload', class: 'btn btn-sm btn-primary' %>
<% end %>

<% if params['remove_all'] == 'yes' %>
  <p><%= link_to "Confirm Delete", sequoia_members_path(remove_all: 'yes', confirm: 'yes'), class: 'btn btn-sm btn-danger mt-4' %></p>
<% else %>
  <p><%= link_to "Remove All Records", sequoia_members_path(remove_all: 'yes'), class: 'btn btn-sm btn-warning mt-4' %></p>
<% end %>

<p><%= link_to 'Export List (csv)', sequoia_members_path('csv'), class: 'btn btn-sm btn-secondary mt-2' %></p>


<div class="m-5">
  <p>Order ID Counter: <%= number_with_delimiter(@order_id) %></p>

<table class="table">
  <thead>
    <tr>
      <th>CPA</th>
      <th>CPA Memberships</th>
      <th>EA</th>
      <th>EA Memberships</th>
      <th>Ethics</th>
      <th>Ehics Purchases</th>
      <th>AFSP</th>
      <th>AFSP Purchases</th>
      <th>Other</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><%= number_with_delimiter(SequoiaMember.where(cpa: true).count) %></td>
      <td><%= number_with_delimiter(SequoiaMember.sum(:cpa_memberships)) %></td>
      <td><%= number_with_delimiter(SequoiaMember.where(ea: true).count) %></td>
      <td><%= number_with_delimiter(SequoiaMember.sum(:ea_memberships)) %></td>
      <td><%= number_with_delimiter(SequoiaMember.where(ethics: true).count) %></td>
      <td><%= number_with_delimiter(SequoiaMember.sum(:ethics_purchases)) %></td>
      <td><%= number_with_delimiter(SequoiaMember.where(afsp: true).count) %></td>
      <td><%= number_with_delimiter(SequoiaMember.sum(:afsp_purchases)) %></td>
      <td><%= number_with_delimiter(SequoiaMember.sum(:other)) %></td>
    </tr>
  </tbody>

</table>
</div>

<div class="m-5">

<table class="table">
<thead>
<caption class="caption-top">Total Records: <%= number_with_delimiter(SequoiaMember.count) %> | Display Limit: 200</caption>
<tr>
      <th>Uid</th>
      <th>Lname</th>
      <th>First purchase</th>
      <th>Last purchase</th>
      <th>Cpa</th>
      <th>Cpa memberships</th>
      <th>Ea</th>
      <th>EA Memberships</th>
      <th>Afsp</th>
      <th>Afsp purchases</th>
      <th>Ethics</th>
      <th>Ethics purchases</th>
      <th>Other</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @sequoia_members.order(updated_at: :desc).limit(200).each do |sequoia_member| %>
      <tr>
        <td><%= sequoia_member.uid %></td>
        <td><%= sequoia_member.lname %></td>
        <td><%= sequoia_member.first_purchase %></td>
        <td><%= sequoia_member.last_purchase %></td>
        <td><%= sequoia_member.cpa %></td>
        <td><%= sequoia_member.cpa_memberships %></td>
        <td><%= sequoia_member.ea %></td>
        <td><%= sequoia_member.ea_memberships %></td>
        <td><%= sequoia_member.afsp %></td>
        <td><%= sequoia_member.afsp_purchases %></td>
        <td><%= sequoia_member.ethics %></td>
        <td><%= sequoia_member.ethics_purchases %></td>
        <td><%= sequoia_member.other %></td>
        <td><%= link_to 'Show', sequoia_member %></td>
        <td><%= link_to 'Edit', edit_sequoia_member_path(sequoia_member) %></td>
        <td><%= link_to 'Destroy', sequoia_member, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>
