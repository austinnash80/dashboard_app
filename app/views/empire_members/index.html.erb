<p id="notice"><%= notice %></p>

<h1 class="text-center">Empire Members</h1>
<p class="text-center"><%= link_to 'Run Member Update', run_update_empire_members_path(), target: "_blank", class: 'btn btn-primary text-light m-2 text-light' %><%= link_to 'Run Purchase Update', run_update_2_empire_members_path(), target: "_blank", class: 'btn btn-primary text-light m-2 text-light' %></p>


<p class="fs-4">Upload New List</p>
  <%= form_tag import_empire_members_path, multipart: true do %>
  <%= file_field_tag :file, class: 'btn btn-sm btn-light' %>
  <%= submit_tag 'Upload', class: 'btn btn-sm btn-primary text-light' %>
<% end %>

<% if params['remove_all'] == 'yes' %>
  <p><%= link_to "Confirm Delete", empire_members_path(remove_all: 'yes', confirm: 'yes'), class: 'btn btn-sm btn-danger mt-4' %></p>
<% else %>
  <p><%= link_to "Remove All Records", empire_members_path(remove_all: 'yes'), class: 'btn btn-sm btn-warning mt-4' %></p>
<% end %>

<p><%= link_to 'Export List (csv)', empire_members_path('csv'), class: 'btn btn-sm btn-secondary text-light mt-2' %></p>


<div class="m-5">
  <table class="table table-striped">
  <thead>
  <caption class="caption-top">Total Records: <%= number_with_delimiter(EmpireMember.count) %> | Display Limit: 250</caption>
    <tr class="bg-secondary bg-gradient text-light">
      <th>Uid</th>
      <th>Lname</th>
      <th>First purchase</th>
      <th>Last purchase</th>
      <th>State</th>
      <th>Purchases</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @empire_members.order(last_purchase: :DESC).order(first_purchase: :DESC).order(uid: :DESC).limit(250).each do |empire_member| %>
      <tr>
        <td><a target="_blank" href="https://www.empirelearning.com/admin/user-profile?u=<%= empire_member.uid %>"><%= empire_member.uid %></a></td>
        <td><%= empire_member.lname %></td>
        <td><%= empire_member.first_purchase %></td>
        <td><%= empire_member.last_purchase %></td>
        <td><%= empire_member.state %></td>
        <td><%= empire_member.purchases %></td>
        <td><%= link_to 'Show', empire_member %></td>
        <td><%= link_to 'Edit', edit_empire_member_path(empire_member) %></td>
        <td><%= link_to 'Destroy', empire_member, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

</div>
